# Tell Travis CI we are using PHP
language: php

# The platforms you wants to test on
dist: trusty
os:
  - linux

# Define the php versions against we want to test our code
php:
  - 5.5
  - 5.6
  - 7.0
  - 7.1
  - 7.2

matrix:
  fast_finish: true
  allow_failures:
    - php: 5.5

# Encrypted variables
env:
  matrix:
    - secure: boP/x3oNeb/ykVxCzIMLrJO3GjdaU6cQjzkVfHH+K7tQDiLRE21C1V9dUqIVhnvWphCk4iU5QmDAIUBbFo7UKO8saHVotgKnBRNd1tvC649F+S2szP+N5nUNOSALWZYTABLRG6aOWBOOjaAWvevjONxbx3SDs1pLFTE1pIUZ8ft6I0GLQQKY3T7oIQN15h72tIIHpmbfavrWYquh5F5LXLvZsW+o4k/O+aQu9zeC2NSxY9bLB4XdgL2vwyOUS93hYDftALCqHEY0wZxTB5QfpfF9Soovey1HUMwmDS0fVil0iHVHmynN0YbpTE27FqUMeklxdUq2i/+a0X2oF4NjNx0CYMcPEeVV2FMEgFQ1zjmc6ADuZaTf4QeSTMhK2ZrBmj1pzwMbh3Pn+LfWm3Y5kEx3MjIT1L+h2NvwXtB1J62wLgx7kCzmsJ5eyJJyrHgimIC9/l8l+AeTayhv0CdPERFnreGgBJn7Nfqx2d3IWq3TJMEPY166KROgjlrYdUcy671sE3qqASiCpgdEyll6060n/QAqG7VclGiMf5OeJwbq/NkXiunIaWwWE1BORFNH1e+u4uuC3D2WxkHryUt57TZz2oaugnN8lo3doJUDG73881GmG65oNjECK7E4uc41KaKrSBTdidOqOxikUWuZDZrV4mQPrYW+0DskSe43Icg=
    - secure: fj5VvMgab48eoRfSuyQRdXzDT36yjNhLS3OU1Q70l6j6ZIWKwhJaZsCeSbCwD2qb+Cpz+5UuOwaVqUfvzkR73Xm3RuJvmtFF87ogBjWG3pGaJp0D1D9liRryC61ddD3Rx8GUuZxQovUF3dF0EvVlnrlxLBXy3mPSka1+XA26sqvaQz34s4HMsgOEvLfmIUDhfgnvr8ES9wyBFENXTg9PN4Tz3AQnHFAiN7O/HCP3+HRgYXiOmmaO88Vu7oOW7ZaouD3SLLWBH+KTfGUOIO0KEmgO5SvNR9TPntrB5XG0x6pPI0ECNHz5423EA5fbXJclEUStAAyB5xORSigwyEmAOnuqehJRWURwxR8AgdjOJ8LlBMsKQzscvS/8NwSz33aY5ERBaxp9AMUDOQujknHUpreEobYam68Y+XUh6HCwj3FK7G1fMxaRj+bd0NM/F73bBZ50bb08YJNrNhy/3hcJxTQx91arAHHHoE2YZv6eiiT6HV4LWAruIk0+J6dtCv1AXjd/x0LIyKGoB4UtsY7/Ew5WLhJ0C8fRBjVLeL7EKwDVjRhyW/rVnCzcdnlf4Rb2MHKPLuRPrurXqx6deYj5FRDPkkYgi567jZDMaFHFkNPJCZjFkUxq+ga4SuLAe/hLTFLXEsDHfcQP542zvzR9hkygQ6Xlu8WGE1+JjnFfpCI=

# We don't want to run linux commands as super user
# false means Travis will run this in a container
sudo: false

# Install packages those will be required during build
install:
  - composer install --no-interaction

# Prepare test environment
before_script:
  ## downloading last codeclimate test report
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
  # creating .env file
  - cp .env.dist .env
  # pass environment variables in travis to the app
  - sed -i "8s/.*/WG_API_KEY=$WG_API_KEY/" .env

# To manage coverage for CodeClimate
after_script:
- mv tests/_output/coverage.xml clover.xml
- ./cc-test-reporter after-build --coverage-input-type clover --id $COVERAGE_ID --exit-code $TRAVIS_TEST_RESULT

# Run main commands
script:
  - composer test

# Cache folder, you can delete cache from Travis CI web interface
cache:
    directories:
        - vendor
        - $HOME/.composer/cache